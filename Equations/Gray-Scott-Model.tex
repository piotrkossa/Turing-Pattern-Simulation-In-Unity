\documentclass[12pt]{article}
\usepackage[colorlinks=true, linkcolor=blue, urlcolor=blue]{hyperref}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{xcolor}

\lstset{
  language=C,
  basicstyle=\ttfamily\small,
  backgroundcolor=\color{gray!10},
  frame=single,
  morekeywords={float, float4, float2, int, int2, uint, uint3, RWTexture2D, Texture2D, sampler2D, clamp, abs, TEXCOORD, SV_Target},
  keywordstyle=\color{blue},
  stringstyle=\color{purple}
}



\title{Equations used for this project}
\author{\href{https://github.com/piotrkossa/Turing-Pattern-Simulation-In-Unity}{github/piotrkossa/Turing-Pattern-Simulation-In-Unity}}
\date{}

\begin{document}
\maketitle

\begin{center}
\href{https://itp.uni-frankfurt.de/~gros/StudentProjects/Projects_2020/projekt_schulz_kaefer/}{Used Source}
\end{center}

\section{The Project Goal}
The goal of this project is to implement the Gray-Scott reaction-diffusion model in real time 
in Unity. It leverages the parallel processing power of the GPU 
using Compute Shaders to visualize complex Turing patterns 
at an efficient refresh rate. This document provides a brief 
description of the mathematical model and its implementation.

\section{Overview}

The simulation bases on the interaction between an \textbf{Activator ($u$)} and an \textbf{Inhibitor ($v$)}.
Everything is driven by a single reaction, where the \textbf{Activator} is used up to create more of the \textbf{Inhibitor}.

\[ 
\scalebox{1.5}{$\displaystyle u + 2v \rightarrow 3v$}
\]
If that was all, the reaction would stop after a certain amount of time. This is why
two processes are constantly active to keep it running:
\begin{enumerate}
\item A specified amount of the \textbf{Activator ($u$)} is continuously 
added to the system, controlled by the \textbf{Feed Rate ($f$)}
\item The \textbf{Inhibitor ($v$)} is slowly removed, controlled by the \textbf{Kill Rate ($k$)}
\end{enumerate}
Obtained patterns come from how the chemicals diffuse on the plane and not the reaction alone.
Spreading out at different speeds causes creation of new unique patterns, even after minor change of \textbf{Diffusion Rates ($D_u, D_v$)}



\section{Equations of the Gray-Scott Model}



\[ 
\scalebox{1.2}{$\displaystyle \partial u/\partial t = (D_u * \nabla^2u) - (u * v^2) + (f * (1 - u))$}
\]
\[ 
\scalebox{1.2}{$\displaystyle \partial v/\partial t = (D_v * \nabla^2v) + (u * v^2) - ((k + f) * v)$}
\]




\begin{center}
    \begin{tabular}{c p{0.5\textwidth}}
        \textbf{Symbol} & \textbf{Description} \\
        $u$ & Concentration of Activator \\
        $v$ & Concentration of Inhibitor \\
        $D_u, D_v$ & Diffusion Rates of Chemicals \\
        $\nabla^2u, \nabla^2v$ & Laplacian - Spatial Diffusion \\
        $f$ & The Feed Rate, represents a constant supply of substance $u$ \\
        $k$ & The Kill Rate, represents the rate of removal of substance $v$ \\
        $\partial u/\partial t, \partial v/\partial t$ & Time Derivatives of Concentrations \\
    \end{tabular}
\end{center}



\section{The Laplacian}
The Laplacian operator ($\nabla^2$) is calculated using a 3x3 convolution kernel:
\[
\begin{bmatrix}
    0.05 & 0.20 & 0.05 \\
    0.20 & -1.0 & 0.20 \\
    0.05 & 0.20 & 0.05
\end{bmatrix}
\]
For each pixel, the values of its eight neighbors and itself are multiplied by the corresponding weights in the kernel, and the results are summed up to produce the final Laplacian value.

\newpage

\section{Code Implementations}
The following code snippets demonstrate how the Gray-Scott model equations are implemented in a custom Unity's Compute Shader.

\begin{enumerate}
\item \textbf{The Laplacian calculation:}

\begin{lstlisting}
float laplacianU = (
    GetNeighbour(id.xy + int2(0, 1)) * 0.2 +
    GetNeighbour(id.xy + int2(0, -1)) * 0.2 +
    GetNeighbour(id.xy + int2(1, 0)) * 0.2 +
    GetNeighbour(id.xy + int2(-1, 0)) * 0.2 +
    GetNeighbour(id.xy + int2(1, 1)) * 0.05 +
    GetNeighbour(id.xy + int2(1, -1)) * 0.05 +
    GetNeighbour(id.xy + int2(-1, 1)) * 0.05 +
    GetNeighbour(id.xy + int2(-1, -1)) * 0.05 -
    prevU
).x;

float laplacianV = (
    GetNeighbour(id.xy + int2(0, 1)) * 0.2 +
    GetNeighbour(id.xy + int2(0, -1)) * 0.2 +
    GetNeighbour(id.xy + int2(1, 0)) * 0.2 +
    GetNeighbour(id.xy + int2(-1, 0)) * 0.2 +
    GetNeighbour(id.xy + int2(1, 1)) * 0.05 +
    GetNeighbour(id.xy + int2(1, -1)) * 0.05 +
    GetNeighbour(id.xy + int2(-1, 1)) * 0.05 +
    GetNeighbour(id.xy + int2(-1, -1)) * 0.05 -
    prevV
).y;
\end{lstlisting}
We take each pixel on the texture and calculate the Laplacian
for both chemicals using the convolution kernel from 
The Laplacian section and its neighboring pixels.

\newpage

\item \textbf{The Gray-Scott equations implementation:}
\begin{lstlisting}
float prevU = prevState[id.xy].x;
float prevV = prevState[id.xy].y;

float reaction = prevU * (prevV * prevV);

float deltaU = (diffusionU * laplacianU) 
    - reaction 
    + (feedRate * (1.0 - prevU));

float deltaV = (diffusionV * laplacianV)
    + reaction 
    - ((killRate + feedRate) * prevV);

float newU = clamp(
    prevU + deltaU * deltaTime, 
    0.0, 
    1.0);

float newV = clamp(
    prevV + deltaV * deltaTime, 
    0.0, 
    1.0);

newU = clamp(newU, 0.0, 1.0);
newV = clamp(newV, 0.0, 1.0);

Result[id.xy] = float4(newU, newV, 0.0, 1.0);
\end{lstlisting}
This code calculates the changes in concentrations
of both chemicals using the mentioned equations. 
It updates the concentrations
based on diffusion, reaction, feed and kill rates, 
ensuring the values remain within 
valid range using clamping function.
\end{enumerate}

\newpage

\section{Pattern Examples}

\newcounter{pattern}
\setcounter{pattern}{1}

\begin{center}
\begin{tabular}{c c}
    \begin{minipage}{0.45\textwidth}
        \includegraphics[width=\linewidth]{Images/Mitosis.png}

        \textbf{Mitosis Pattern} \newline
        \textit{Feed Rate: 0.028\newline Kill Rate: 0.062}

    \end{minipage} &
    \stepcounter{pattern}
    \begin{minipage}{0.45\textwidth}

        \includegraphics[width=\linewidth]{Images/Flowers.png}

        \textbf{Flowers Pattern} \newline
        \textit{Feed Rate: 0.055\newline Kill Rate: 0.062}
    \end{minipage} \newline
    \vspace{1cm} \\

    \stepcounter{pattern}
    \begin{minipage}{0.45\textwidth}
        \includegraphics[width=\linewidth]{Images/Mazes.png}

        \textbf{Mazes Pattern} \newline
        \textit{Feed Rate: 0.029\newline Kill Rate: 0.057}

    \end{minipage} &
    \stepcounter{pattern}
    \begin{minipage}{0.45\textwidth}

        \includegraphics[width=\linewidth]{Images/Solitions.png}

        \textbf{Solitions Pattern} \newline
        \textit{Feed Rate: 0.03\newline Kill Rate: 0.06}
    \end{minipage} \newline
\end{tabular}
\end{center}

\end{document}